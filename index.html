<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>اختبار الشارت + EMA 20/25/70 (محلي)</title>
<script src="https://unpkg.com/lightweight-charts@4.2.1/dist/lightweight-charts.standalone.production.js"></script>
<style>
  html,body{height:100%;margin:0;background:#0b0b0b;color:#eee;font-family:system-ui,-apple-system,Segoe UI,Roboto}
  header{padding:.75rem 1rem;background:#000;position:sticky;top:0}
  .wrap{max-width:1100px;margin:0 auto;padding:0 1rem}
  #chart{height:70vh;border:1px solid #222;border-radius:10px;background:#111;margin:12px 0}
  .legend{display:flex;gap:10px;flex-wrap:wrap;font-size:.9rem}
  .badge{padding:.2rem .5rem;border-radius:6px;background:#1b1b1b;border:1px solid #2a2a2a}
  .y{color:#ffd000}.o{color:#ffa726}.b{color:#64b5f6}
</style>
</head>
<body>
  <header><div class="wrap"><b>اختبار</b> — شارت + EMA 20/25/70 (بيانات ثابتة)</div></header>
  <div class="wrap">
    <div id="chart"></div>
    <div class="legend">
      <span class="badge y">EMA 20 (أصفر)</span>
      <span class="badge o">EMA 25 (برتقالي)</span>
      <span class="badge b">EMA 70 (أزرق)</span>
    </div>
  </div>

<script>
/* بيانات عينات شموع (15m تقريباً) — 100 شمعة */
const seed = [
  45600,45620,45610,45640,45680,45630,45650,45710,45760,45720,
  45780,45820,45860,45810,45840,45910,45970,45930,45900,45850,
  45890,45930,45980,46020,46000,45960,45920,45950,46010,46040,
  46020,45990,45950,45910,45890,45910,45940,45980,46010,45970,
  45930,45900,45940,45990,46030,46070,46110,46060,46010,45970,
  45930,45960,46000,46050,46020,45980,45940,45900,45870,45910,
  45950,45990,46030,46060,46020,45980,45950,45920,45890,45930,
  45980,46020,46060,46030,45990,45950,45910,45880,45850,45890,
  45920,45970,46010,46050,46020,45980,45940,45900,45870,45840,
  45880,45920,45960,45930,45890,45850,45810,45780,45740,45710
];

// حوّلها لشموع بسيطة
const candles = seed.map((p, i) => {
  const base = p;
  const o = base + (Math.random()*8-4);
  const c = base + (Math.random()*8-4);
  const h = Math.max(o, c) + (Math.random()*6);
  const l = Math.min(o, c) - (Math.random()*6);
  return {
    time: (Math.floor(Date.now()/1000) - (seed.length-i)*900), // كل 15 دقيقة
    open: +o.toFixed(2), high: +h.toFixed(2), low: +l.toFixed(2), close: +c.toFixed(2)
  };
});

// دوال EMA
function ema(values, period, accessor) {
  const k = 2/(period+1);
  let prev;
  return values.map((v, i) => {
    const price = accessor(v);
    if (i === 0) { prev = price; return { time:v.time, value: price }; }
    const val = price * k + prev * (1-k);
    prev = val; 
    return { time:v.time, value: +val.toFixed(2) };
  });
}

// ارسم الشارت
const chart = LightweightCharts.createChart(document.getElementById('chart'), {
  layout:{ background:{ type:'solid', color:'#111' }, textColor:'#e0e0e0' },
  grid:{ vertLines:{ color:'#1c1c1c' }, horzLines:{ color:'#1c1c1c' } },
  rightPriceScale:{ borderColor:'#222' },
  timeScale:{ borderColor:'#222' },
  crosshair:{ mode: LightweightCharts.CrosshairMode.Normal }
});

const candleSeries = chart.addCandlestickSeries({
  upColor:'#26a69a', downColor:'#ef5350', borderDownColor:'#ef5350',
  borderUpColor:'#26a69a', wickDownColor:'#888', wickUpColor:'#888'
});
candleSeries.setData(candles);

// EMAs
const ema20 = chart.addLineSeries({ color:'#ffd000', lineWidth:2 });
const ema25 = chart.addLineSeries({ color:'#ffa726', lineWidth:2 });
const ema70 = chart.addLineSeries({ color:'#64b5f6', lineWidth:3 });

ema20.setData(ema(candles, 20, d=>d.close));
ema25.setData(ema(candles, 25, d=>d.close));
ema70.setData(ema(candles, 70, d=>d.close));

chart.timeScale().fitContent();
</script>
</body>
</html>
